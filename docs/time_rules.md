# Time Rules (Phase 0)This document defines the canonical time and session rules for the application. These rules drive:- import timestamp interpretation- `trading_date_ct_int` computation- session classification (ON vs RTH)- 30-minute bucketing and `period_index`Any code that deals with dates/sessions/buckets must use these rules.## Canonical timestamp storage### Stored timestamp- `ts_start_utc`: epoch seconds (INTEGER), representing the bar **start instant**.Epoch seconds are an absolute instant. They are not “in CT” or “in UTC”; they are timezone-neutral. We treat the value as UTC epoch for conversion purposes.### Import timestamp interpretation- Source timestamps in CSV are interpreted using a selectable timezone:  - default `input_timezone = America/Chicago` (CT)  - import must support overriding the timezone (e.g., `America/New_York`)- After interpretation, timestamps are converted to `ts_start_utc` for storage.### CT helper fields (to avoid conversion in analytics)To keep analytics queries simple and fast, store:- `trading_date_ct_int`: INTEGER `YYYYMMDD`, computed using CT rollover rule below- `ct_minute_of_day`: INTEGER `0..1439`, the bar start minute in CTThese fields are computed once during import and used for downstream filters.## Trading date rule (CT rollover)Trading date is defined in **CT** with a **17:00** rollover.Given a bar start time in CT:- If CT-local time is **>= 17:00:00**, trading date is the **next** calendar date (CT)- Else, trading date is the **same** calendar date (CT)`trading_date_ct_int` is stored as `YYYYMMDD`, e.g., `20251216`.## Session definitions (CT)All session membership is determined from `ct_minute_of_day` (bar start minute in CT).### Overnight (ON)- ON start: 17:00:00 CT  -> minute 1020- ON end:   08:29:59 CT  -> last valid bar start minute 509Predicate:- ON if `ct_minute_of_day >= 1020 OR ct_minute_of_day <= 509`### Regular Trading Hours (RTH)- RTH start: 08:30:00 CT -> minute 510- RTH end:   15:59:59 CT -> last valid bar start minute 959Predicate:- RTH if `510 <= ct_minute_of_day <= 959`### Out-of-session (v1 behavior)Minutes `960..1019` (16:00:00–16:59:59 CT) are neither ON nor RTH.v1 behavior:- exclude these bars from ON/RTH analytics unless explicitly required by a specific report.## Bar intervals and bucketing### Canonical vs derived- Canonical bars: 1-minute (`bars_1m`)- Derived bars: 30-minute (`bars_30m`), computed from 1-minute bars### 30-minute bucket alignment30-minute buckets align to CT wall-clock half-hours:- bucket start minute-of-day is in `{0, 30, 60, ..., 1410}`This aligns with:- ON start at 17:00 (on the hour)- RTH start at 08:30 (on the half hour)## 30-minute period indexing`period_index` is stored on derived 30-minute bars and is the authoritative “period identity” for TPO labeling and grouping.### RTH 30-minute bucketsValid RTH bucket starts (CT):- 08:30 (510), 09:00 (540), ..., 15:30 (930)- The 15:30–16:00 bucket is included because RTH ends at 15:59:59.Definition:- `period_index = (bucket_ct_minute_of_day - 510) // 30`- Range: `0..14`### ON 30-minute buckets (wraps midnight)ON runs continuously from 17:00 through 08:30 next day (30 buckets).Definition:- `shifted = bucket_ct_minute_of_day - 1020`- if `shifted < 0`, then `shifted += 1440`- `period_index = shifted // 30`- Range: `0..29`## TPO label (display)TPO is a display label derived from `period_index` and session:- ON uses lowercase- RTH uses uppercaseImportant:- ON has 30 buckets, which exceeds single-letter labels (`a..z`). Labels must support values beyond `z`  (e.g., `aa`, `ab`, ...). Therefore `tpo` must not be constrained to length 1 if stored.Recommendation:- Treat `tpo` as derived/display-only and rely on `period_index` for all math.## Deferred / out of scope for v1- Early closes / holiday schedules (document later if needed)- Exact definition of “breach” for rolling breach analytics (up/down/either; strict vs touch)